<!DOCTYPE html>
<html>

<head>

</head>

<body>

  <style>
    html,
    body {
      width: 100%;
      height: 100%;
      margin: 0;
      padding: 0;
      background-color: black;
    }

    canvas#environment {
      width: 100vw;
      height: 100vh;
    }
  </style>

  <canvas id="environment" width="1000" height="500"></canvas>

  <script type="text/javascript">

    const getRandX = () => Math.random() * 1000; // canvas width
    const getRandY = () => Math.random() * 500; // canvas height
    const getRand10 = () => Math.random() * 10;

    let mossCollection = [];
    let emonoCollection = [];

    class Moss {

      constructor(x, y) {
        this.x = x;
        this.y = y;
        this.rad = 0.1;
      }

      birth(ctx) {
        ctx.fillStyle = 'green';
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.rad, 0, Math.PI * 2, true);
        ctx.fill();
      }

      age(ctx) {
        if (this.isDead) return;
        if (this.rad > 2 + getRand10()) this._die(ctx);
        else this._grow(ctx);
      }

      _grow(ctx) {
        this.rad += 0.1;
        ctx.fillStyle = 'green';
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.rad, 0, Math.PI * 2, true);
        ctx.fill();
      }

      _die(ctx) {
        this.isDead = true;
        ctx.fillStyle = 'black';
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.rad, 0, Math.PI * 2, true);
        ctx.fill();
        ctx.stroke();
        let index = mossCollection.findIndex(d => d === this);
        mossCollection.splice(index, 1);
      }

    }

    class Emono {

      constructor(x, y) {
        this.x = x;
        this.y = y;
        this.rad = 0.3;
      }

      birth(ctx) {
        ctx.fillStyle = 'blue';
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.rad, 0, Math.PI * 2, true);
        ctx.fill();
      }

      age(ctx) {
        if (this.isDead) return;
        if (this.rad > 5 + getRand10()) return this._die(ctx);
        else return this._grow(ctx);
      }

      _grow(ctx) {
        this.rad += 0.1;
        ctx.fillStyle = 'blue';
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.rad, 0, Math.PI * 2, true);
        ctx.fill();
      }

      _die(ctx) {
        this.isDead = true;
        ctx.fillStyle = 'black';
        ctx.beginPath();
        ctx.arc(this.x, this.y, this.rad, 0, Math.PI * 2, true);
        ctx.fill();
        let index = emonoCollection.findIndex(d => d === this);
        emonoCollection.splice(index, 1);
      }

    }


    window.onload = e => {

      // Onload (get user inputs)

      // Init (populate environment)
      const canvas = document.getElementById("environment");
      const ctx = canvas.getContext("2d");

      for (let i = 0; i < 100; i++) {

        let moss = new Moss(getRandX(), getRandY());
        mossCollection.push(moss);
        moss.birth(ctx);

        let emono = new Emono(getRandX(), getRandY());
        emonoCollection.push(emono);
        emono.birth(ctx);

      }

      // Start timeline
      let years = 0;
      setInterval(() => {

        years += 10;

        mossCollection.forEach(moss => moss.age(ctx));

        // If all emonos are dead
        if (emonoCollection.length === 0) console.log("All Emonos are dead!");

        emonoCollection.forEach(emono => emono.age(ctx));

      }, 200);

    };



  </script>

</body>

</html>